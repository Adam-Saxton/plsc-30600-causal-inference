pci$abcix_w <- pci$abcix_resid^2
# Regression is a weighting estimator :)
weighted.mean(pci$sixMonthSurvive, pci$abcix_w)
full_reg <- lm_robust(sixMonthSurvive ~ abcix + stent + female + diabetic + height + acutemi + ejecfrac + I(ejecfrac^2) + ves1proc + I(ves1proc^2), data=pci)
tidy(full_reg) %>% filter(term == "abcix")
# Get the weights
resid_reg <- lm_robust(abcix ~stent + female + diabetic + height + acutemi + ejecfrac + I(ejecfrac^2) + ves1proc + I(ves1proc^2), data=pci)
pci$abcix_resid <- pci$abcix - resid_reg$fitted.values
pci$abcix_w <- pci$abcix_resid^2
# Summarize
hist(pci$abcix_w, main = "", xlab="Weight on treatment effect")
full_reg <- lm_robust(sixMonthSurvive ~ abcix + stent + female + diabetic + height + acutemi + ejecfrac + I(ejecfrac^2) + ves1proc + I(ves1proc^2), data=pci)
tidy(full_reg) %>% filter(term == "abcix")
# Get the weights
resid_reg <- lm_robust(abcix ~stent + female + diabetic + height + acutemi + ejecfrac + I(ejecfrac^2) + ves1proc + I(ves1proc^2), data=pci)
pci$abcix_resid <- pci$abcix - resid_reg$fitted.values
# Show FWL working
weighted.mean(pci$sixMonthSurvive[pci$abcix == 1], pci$abcix_resid[pci$abcix == 1]) -
weighted.mean(pci$sixMonthSurvive[pci$abcix == 0], pci$abcix_resid[pci$abcix == 0])
# Weights on individual treatment effects
pci$abcix_w <- pci$abcix_resid^2
full_reg <- lm_robust(sixMonthSurvive ~ abcix + stent + female + diabetic + height + acutemi + ejecfrac + I(ejecfrac^2) + ves1proc + I(ves1proc^2), data=pci)
tidy(full_reg) %>% filter(term == "abcix")
# Get the weights
resid_reg <- lm_robust(abcix ~stent + female + diabetic + height + acutemi + ejecfrac + I(ejecfrac^2) + ves1proc + I(ves1proc^2), data=pci)
pci$abcix_resid <- pci$abcix - resid_reg$fitted.values
# Show FWL working
lm_robust(sixMonthSurvive ~ abcix_resid, data=pci)
# Weights on individual treatment effects
pci$abcix_w <- pci$abcix_resid^2
full_reg <- lm_robust(sixMonthSurvive ~ abcix + stent + female + diabetic + height + acutemi + ejecfrac + I(ejecfrac^2) + ves1proc + I(ves1proc^2), data=pci)
tidy(full_reg) %>% filter(term == "abcix")
# Get the weights
resid_reg <- lm_robust(abcix ~stent + female + diabetic + height + acutemi + ejecfrac + I(ejecfrac^2) + ves1proc + I(ves1proc^2), data=pci)
pci$abcix_resid <- pci$abcix - resid_reg$fitted.values
# Show FWL working
partial_reg <- lm_robust(sixMonthSurvive ~ abcix_resid, data=pci)
tidy(partial_reg) %>% filter(term == "abcix")
# Weights on individual treatment effects
pci$abcix_w <- pci$abcix_resid^2
full_reg <- lm_robust(sixMonthSurvive ~ abcix + stent + female + diabetic + height + acutemi + ejecfrac + I(ejecfrac^2) + ves1proc + I(ves1proc^2), data=pci)
tidy(full_reg) %>% filter(term == "abcix")
# Get the weights
resid_reg <- lm_robust(abcix ~stent + female + diabetic + height + acutemi + ejecfrac + I(ejecfrac^2) + ves1proc + I(ves1proc^2), data=pci)
pci$abcix_resid <- pci$abcix - resid_reg$fitted.values
# Show FWL working
partial_reg <- lm_robust(sixMonthSurvive ~ abcix_resid, data=pci)
tidy(partial_reg) %>% filter(term == "abcix_resid")
# Weights on individual treatment effects
pci$abcix_w <- pci$abcix_resid^2
knitr::opts_chunk$set(echo = TRUE)
# Useful packages
library(tidyverse)
library(haven)
library(texPreview)
cobalt::bal.tab(ohie %>% select(tab1_gender_inp, tab1_age_19_34_inp, tab1_age_35_49_inp, tab1_race_black_inp, tab1_race_nwother_inp, tab1_race_white_inp, tab1_hispanic_inp), treat=ohie$ohp_all_ever_admin, s.d.denom="pooled",  binary = "std")
lm_robust(tab2phqtot_high ~ treatment, data=ohie_complete)
# Which observations have all non-missing outcomes + covariates
ohie$nonmissing <- complete.cases(ohie %>% select(tab2bp_hyper, tab2phqtot_high, tab4_catastrophic_exp_inp, tab1_gender_inp, tab1_age_19_34_inp, tab1_age_35_49_inp, tab1_race_black_inp, tab1_race_nwother_inp, tab1_race_white_inp, tab1_hispanic_inp))
knitr::opts_chunk$set(echo = TRUE)
# Useful packages
library(tidyverse)
library(haven)
library(texPreview)
knitr::include_graphics("dag1.png")
library(estimatr)
library(tidyverse)
library(haven)
ohie <- haven::read_dta("OHIE.dta")
# Which observations have all non-missing outcomes + covariates
ohie$nonmissing <- complete.cases(ohie %>% select(tab2bp_hyper, tab2phqtot_high, tab4_catastrophic_exp_inp, tab1_gender_inp, tab1_age_19_34_inp, tab1_age_35_49_inp, tab1_race_black_inp, tab1_race_nwother_inp, tab1_race_white_inp, tab1_hispanic_inp))
# Which observations have all non-missing outcomes + covariates
ohie$nonmissing <- complete.cases(ohie %>% dplyr::select(tab2bp_hyper, tab2phqtot_high, tab4_catastrophic_exp_inp, tab1_gender_inp, tab1_age_19_34_inp, tab1_age_35_49_inp, tab1_race_black_inp, tab1_race_nwother_inp, tab1_race_white_inp, tab1_hispanic_inp))
# Subset down to complete cases
ohie_complete <- ohie %>% filter(nonmissing == 1)
lm_robust(tab2phqtot_high ~ treatment, data=ohie_complete)
lm_robust(tab2phqtot_high ~ treatment, data=ohie_complete %>% filter(!(treatment==1&ohp_all_ever_admin==0)&!(treatment == 0&ohp_all_ever_admin==1)))
lm_robust(tab2phqtot_high ~ treatment, data=ohie_complete)
mean(ohie_complete$treatment == 0 & ohie_complete$ohp_all_ever_admin == 1)
mean(ohie_complete$treatment == 1 & ohie_complete$ohp_all_ever_admin == 0)
mean(ohie_complete$treatment == 1 & ohie_complete$ohp_all_ever_admin == 1)
mean(ohie_complete$treatment == 0 & ohie_complete$ohp_all_ever_admin == 0)
### Load in the Egan and Mullin (2013) dataset
gwdataset <- read_dta("gwdataset.dta")
gwdataset
?cobalt::bal.tab
### Load in the Egan and Mullin (2013) dataset
gwdataset <- read_dta("gwdataset.dta")
cobalt::bal.tab(gwdataset %>% select(`party_rep`, `party_dem`, `male`, `educ_coll`, `educ_postgrad`, `age_1824`, `age_2534`, `age_3544`, `age_5564`), treat = gwdataset$ddt_week > 10)
### Load in the Egan and Mullin (2013) dataset
gwdataset <- read_dta("gwdataset.dta")
cobalt::bal.tab(gwdataset %>% dplyr::select(`party_rep`, `party_dem`, `male`, `educ_coll`, `educ_postgrad`, `age_1824`, `age_2534`, `age_3544`, `age_5564`), treat = gwdataset$ddt_week > 10)
### Load in the Egan and Mullin (2013) dataset
gwdataset <- read_dta("gwdataset.dta")
cobalt::bal.tab(gwdataset %>% dplyr::select(`wave`, `party_rep`, `party_dem`, `male`, `educ_coll`, `educ_postgrad`, `age_1824`, `age_2534`, `age_3544`, `age_5564`), treat = gwdataset$ddt_week > 10)
gwdataset <- gwdatset %>% filter(!(ddt_week < -10|ddt_week > 20))
gwdataset <- gwdataset %>% filter(!(ddt_week < -10|ddt_week > 20))
knitr::opts_chunk$set(echo = TRUE)
# Useful packages
library(tidyverse)
library(haven)
knitr::include_graphics("dag1.png")
View(pci)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(estimatr)
benchmark <- haven::read_dta("nsw_exper.dta")
lalonde <- haven::read_dta("nsw_psid_withtreated.dta")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(estimatr)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(estimatr)
library(cobalt)
lm_robust(re78 ~ nsw, data=benchmark)
lm_robust(re78 ~ nsw, data=lalonde)
# Experimental data
cobalt::balt.tab(benchmark %>% select(age, educ, black, hisp, married, re74, re75, u74, u75), treat=benchmark$nsw, binary="std")
# Experimental data
cobalt::bal.tab(benchmark %>% select(age, educ, black, hisp, married, re74, re75, u74, u75), treat=benchmark$nsw, binary="std")
# Experimental data
cobalt::bal.tab(benchmark %>% select(age, educ, black, hisp, married, re74, re75, u74, u75), treat=benchmark$nsw, binary="std", sd.denom="pooled")
# Observational data
cobalt::bal.tab(lalonde %>% select(age, educ, black, hisp, married, re74, re75, u74, u75), treat=lalonde$$nsw, binary="std", sd.denom="pooled")
# Experimental data
cobalt::bal.tab(benchmark %>% select(age, educ, black, hisp, married, re74, re75, u74, u75), treat=benchmark$nsw, binary="std", sd.denom="pooled")
# Observational data
cobalt::bal.tab(lalonde %>% select(age, educ, black, hisp, married, re74, re75, u74, u75), treat=lalonde$nsw, binary="std", sd.denom="pooled")
lm_robust(re78 ~ nsw + age + educ + black + hisp + married + re74 + re75 + u74 + u75, data=lalonde)
lalonde %>% ggplot(aes(x=re75, y=re78, colour = as.factor(nsw))) + geom_point() + xlab("Real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
source("stat_binscatter.R")
source("stat_binscatter.R")
lalonde %>% ggplot(aes(x=re75, y=re78, colour = as.factor(nsw))) + stat_binscatter() + xlab("Real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
source("stat_binscatter.R")
lalonde %>% ggplot(aes(x=re75, y=re78, colour = as.factor(nsw))) + stat_binscatter(bins=8) + xlab("Real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
ihs <- function(x) {
y <- log(x + sqrt(x ^ 2 + 1))
return(y)
}
lalonde %>% ggplot(aes(x=ihs(re75), y=ihs(re78), colour = as.factor(nsw))) + stat_binscatter(bins=8) + xlab("Transformed real earnings for 1975") + ylab("Transformed real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
ihs <- function(x) {
y <- log(x + sqrt(x ^ 2 + 1))
return(y)
}
lalonde %>% ggplot(aes(x=ihs(re75), y=ihs(re78), colour = as.factor(nsw))) + stat_binscatter(bins=10) + xlab("Transformed real earnings for 1975") + ylab("Transformed real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
ihs <- function(x) {
y <- log(x + sqrt(x ^ 2 + 1))
return(y)
}
lalonde %>% ggplot(aes(x=ihs(re75), y=ihs(re78), colour = as.factor(nsw))) + stat_binscatter(bins=8) + xlab("Transformed real earnings for 1975") + ylab("Transformed real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
ihs <- function(x) {
y <- log(x + sqrt(x ^ 2 + 1))
return(y)
}
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=ihs(re75), y=ihs(re78), colour = as.factor(nsw))) + stat_binscatter(bins=8) + xlab("Transformed real earnings for 1975") + ylab("Transformed real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=re75, y=re78, colour = as.factor(nsw))) + stat_binscatter(bins=8) + xlab("Real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=re75, y=re78, colour = as.factor(nsw))) + stat_binscatter(bins=8) + xlab("Real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=log(re78), colour = as.factor(nsw))) + stat_binscatter(bins=8) + xlab("Real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
lalonde %>% filter(re75 > 0) %>% ggplot(aes(x=log(re75), y=log(re78), colour = as.factor(nsw))) + stat_binscatter(bins=8) + xlab("Real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
ihs <- function(x) {
y <- log(x + sqrt(x ^ 2 + 1))
return(y)
}
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=ihs(re75), y=ihs(re78), colour = as.factor(nsw))) + stat_binscatter(bins=8) + xlab("Real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
ihs <- function(x) {
y <- log(x + sqrt(x ^ 2 + 1))
return(y)
}
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=ihs(re75), y=ihs(re78), colour = as.factor(nsw))) + geom_point() + xlab("Transformed real earnings for 1975") + ylab("Transformed real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
ihs <- function(x) {
y <- log(x + sqrt(x ^ 2 + 1))
return(y)
}
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=ihs(re75), y=re78, colour = as.factor(nsw))) + geom_point() + xlab("Transformed real earnings for 1975") + ylab("Transformed real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
ihs <- function(x) {
y <- log(x + sqrt(x ^ 2 + 1))
return(y)
}
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=ihs(re75), y=ihs(re78), colour = as.factor(nsw))) + geom_point() + xlab("Transformed real earnings for 1975") + ylab("Transformed real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
ihs <- function(x) {
y <- log(x + sqrt(x ^ 2 + 1))
return(y)
}
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + geom_point() + xlab("Transformed real earnings for 1975") + ylab("Transformed real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
source("stat_binscatter.R")
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + stat_binscatter() + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Linear
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + stat_binscatter() + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Quadratic
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + stat_binscatter() + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2)) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Linear
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=ihs(re78), colour = as.factor(nsw))) + stat_binscatter() + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Quadratic
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + stat_binscatter() + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2)) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Linear
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + stat_binscatter() + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Quadratic
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + stat_binscatter() + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2)) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
#  Cubic
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + stat_binscatter() + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2) + I(x^3)) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
ihs <- function(x) {
y <- log(x + sqrt(x ^ 2 + 1))
return(y)
}
# Linear
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=ihs(re78), colour = as.factor(nsw))) + stat_binscatter() + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Transformed real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Quadratic
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=ihs(re78), colour = as.factor(nsw))) + stat_binscatter() + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2)) + xlab("Transformed real earnings for 1975") + ylab("Transformed real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
#  Cubic
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=ihs(re78), colour = as.factor(nsw))) + stat_binscatter() + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2) + I(x^3)) + xlab("Transformed real earnings for 1975") + ylab("Transformed real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Quick match on two covariates
match_temp <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, covs = lalonde %>% filter(u75, re75),
M = 3, Weight = 2, estimand = "ATT")
# Quick match on two covariates
match_temp <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = lalonde %>% filter(u75, re75),
M = 3, Weight = 2, estimand = "ATT")
# Quick match on two covariates
match_temp <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = lalonde %>% dplyr::select(u75, re75),
M = 3, Weight = 2, estimand = "ATT")
summary(match_temp)
match_weights = table(c(match_temp$index.control, match_temp$index.treated))/3
match_weights
sum(match_weights == 0)
match_temp$index.control
match_temp$index.dropped
match_temp$index.treated
# Quick match on two covariates
match_temp <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = lalonde %>% dplyr::select(re75),
M = 3, Weight = 2, estimand = "ATT")
summary(match_temp)
match_weights = table(c(match_temp$index.control, match_temp$index.treated))/3
match_weights
match_temp$index.treated
match_temp$index.dropped
# Quick match on two covariates
match_temp <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = as.matrix(lalonde %>% dplyr::select(re75)),
M = 3, Weight = 2, estimand = "ATT")
summary(match_temp)
?Matching::Match
# Quick match on two covariates
match_temp <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = as.matrix(lalonde %>% dplyr::select(re75)),
M = 3, Weight = 2, estimand = "ATT", ties = F) #
summary(match_temp)
# Quick match on two covariates
match_temp <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = as.matrix(lalonde %>% dplyr::select(re75)),
M = 3, Weight = 2, estimand = "ATT", ties = F) #
summary(match_temp)
# Quick match on two covariates
match_temp <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = as.matrix(lalonde %>% dplyr::select(re75)),
M = 3, Weight = 2, estimand = "ATT", ties = F) #
summary(match_temp)
# Quick match on two covariates
# Set ties = F to randomly break ties in distances. ties = T will change M to accomodate ties and increase the number of observations used
set.seed(60637)
match_temp <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = as.matrix(lalonde %>% dplyr::select(re75)),
M = 3, Weight = 2, estimand = "ATT", ties = F) #
summary(match_temp)
# Quick match on two covariates
# Set ties = F to randomly break ties in distances. ties = T will change M to accomodate ties and increase the number of observations used
set.seed(60637)
match_temp <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = as.matrix(lalonde %>% dplyr::select(re75)),
M = 3, Weight = 2, estimand = "ATT", ties = F) #
summary(match_temp)
# Quick match on two covariates
# Set ties = F to randomly break ties in distances. ties = T will change M to accomodate ties and increase the number of observations used
set.seed(60638)
match_temp <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = as.matrix(lalonde %>% dplyr::select(re75)),
M = 3, Weight = 2, estimand = "ATT", ties = F) #
summary(match_temp)
# Quick match on two covariates
# Set ties = F to randomly break ties in distances. ties = T will change M to accomodate ties and increase the number of observations used
set.seed(60639)
match_temp <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = as.matrix(lalonde %>% dplyr::select(re75)),
M = 3, Weight = 2, estimand = "ATT", ties = F) #
summary(match_temp)
# Quick match on two covariates
# Set ties = F to randomly break ties in distances. ties = T will change M to accomodate ties and increase the number of observations used
set.seed(60634)
match_temp <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = as.matrix(lalonde %>% dplyr::select(re75)),
M = 3, Weight = 2, estimand = "ATT", ties = F) #
summary(match_temp)
# Quick match on two covariates
# Set ties = F to randomly break ties in distances. ties = T will change M to accomodate ties and increase the number of observations used
set.seed(60633)
match_temp <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = as.matrix(lalonde %>% dplyr::select(re75)),
M = 3, Weight = 2, estimand = "ATT", ties = F) #
summary(match_temp)
library(Matching)
match_result <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = lalonde %>% select(age, educ, black, hisp, married, re74, re75, u74, u75),
M = 3, Weight = 2, estimand = "ATT")
library(Matching)
match_result <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = lalonde %>% dplyr::select(age, educ, black, hisp, married, re74, re75, u74, u75),
M = 3, Weight = 2, estimand = "ATT")
summary(match_result)
library(Matching)
match_result <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = lalonde %>% dplyr::select(age, educ, black, hisp, married, re74, re75, u74, u75),
M = 3, Weight = 2, estimand = "ATT", ties = F)
summary(match_result)
library(Matching)
match_result <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = lalonde %>% dplyr::select(age, educ, black, hisp, married, re74, re75, u74, u75),
M = 3, Weight = 2, estimand = "ATT", ties = F)
summary(match_result)
library(Matching)
match_result <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = lalonde %>% dplyr::select(age, educ, black, hisp, married, re74, re75, u74, u75),
M = 3, Weight = 2, estimand = "ATT", ties = F)
summary(match_result)
# Quick match on two covariates
# Set ties = F to randomly break ties in distances. ties = T will change M to accomodate ties and increase the number of observations used - with lots of covariates, ties are rare so this doesn't matter much here.
set.seed(60637)
match_result <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = lalonde %>% dplyr::select(age, educ, black, hisp, married, re74, re75, u74, u75),
M = 3, Weight = 2, estimand = "ATT", ties = F)
summary(match_result)
# Quick match on two covariates
# Set ties = F to randomly break ties in distances. ties = T will change M to accomodate ties and increase the number of observations used - with lots of covariates, ties are rare so this doesn't matter much here.
set.seed(60637)
match_result <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = lalonde %>% dplyr::select(age, educ, black, hisp, married, re74, re75, u74, u75),
M = 3, Weight = 2, estimand = "ATT", ties = F)
summary(match_result)
# Set ties = F to randomly break ties in distances. ties = T will change M to accomodate ties and increase the number of observations used - with lots of covariates, ties are rare so this doesn't matter much here.
set.seed(60637)
match_result <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = lalonde %>% dplyr::select(age, educ, black, hisp, married, re74, re75, u74, u75),
M = 3, Weight = 2, estimand = "ATT", ties = F, BiasAdjust = T)
summary(match_result)
# Set ties = F to randomly break ties in distances. ties = T will change M to accomodate ties and increase the number of observations used - with lots of covariates, ties are rare so this doesn't matter much here.
set.seed(60637)
match_result <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = lalonde %>% dplyr::select(age, educ, black, hisp, married, re74, re75, u74, u75),
M = 3, Weight = 2, estimand = "ATT", ties = T, BiasAdjust = T)
summary(match_result)
# Set ties = F to randomly break ties in distances. ties = T will change M to accomodate ties and increase the number of observations used - with lots of covariates, ties are rare so this doesn't matter much here.
set.seed(60637)
match_result <- Matching::Match(Y = lalonde$re78, Tr = lalonde$nsw, X = lalonde %>% dplyr::select(age, educ, black, hisp, married, re74, re75, u74, u75),
M = 3, Weight = 2, estimand = "ATT", ties = F)
summary(match_result)
match_weights = table(c(match_result$index.control, match_result$index.treated))/3
match_weights
match_weights = table(c(match_result$index.control, match_result$index.treated))/3
lalonde$matchweight <- 0
lalonde$matchweight[as.numeric(names(match_weights))] <- match_weights # match_weights is the weight for each row number - this is a quick trick to assign the weights to the right rows
# What's the share of observations with 0 weight
mean(lalonde$matchweight = 0)
match_weights = table(c(match_result$index.control, match_result$index.treated))/3
lalonde$matchweight <- 0
lalonde$matchweight[as.numeric(names(match_weights))] <- match_weights # match_weights is the weight for each row number - this is a quick trick to assign the weights to the right rows
# What's the share of observations with 0 weight
mean(lalonde$matchweight == 0)
# Scatterplot
lalonde_postmatch %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), size = matchweight)) + geom_point() +  xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
match_weights = table(c(match_result$index.control, match_result$index.treated))/3
lalonde$matchweight <- 0
lalonde$matchweight[as.numeric(names(match_weights))] <- match_weights # match_weights is the weight for each row number - this is a quick trick to assign the weights to the right rows
# What's the share of observations with 0 weight
mean(lalonde$matchweight == 0)
# Subset the data to post-matching observations
lalonde_postmatch <- lalonde %>% filter(matchweight != 0)
# Scatterplot
lalonde_postmatch %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), size = matchweight)) + geom_point() +  xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
lalonde_postmatch[lalonde_postmatch$nsw == 1]$matchweight
lalonde_postmatch[lalonde_postmatch$nsw == 1,]$matchweight
# Linear
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), size = matchweight, weight = matchweight)) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Quadratic
lalonde_postmatch %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + stat_binscatter() + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2)) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
#  Cubic
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + stat_binscatter() + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2) + I(x^3)) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Linear
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), size = matchweight)) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x, aes(weight=matchweight)) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Quadratic
lalonde_postmatch %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + stat_binscatter() + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2)) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
#  Cubic
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + stat_binscatter() + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2) + I(x^3)) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
?lm_robust
# Linear
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), size = matchweight)) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x, method.args = list(weights = matchweight)) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Linear
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), size = matchweight)) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x, method.args = list(weights = lalonde_postmatch$matchweight)) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Linear
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x, method.args = list(weights = lalonde_postmatch$matchweight)) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Linear
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Linear
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), weights=matchingweight)) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Linear
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), weights=matchgweight)) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Linear
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), weights=matchweight)) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Linear
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), weight=matchweight)) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Linear
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), weight=matchweight)) + geom_point() + geom_smooth(method="lm", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Linear
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), size = matchweight, weight=matchweight)) + geom_point(aes(size=matchweight)) + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Linear
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), size = matchweight, weight=matchweight)) + geom_point(aes(size=matchweight)) + geom_smooth(method="lm_robust", formula = y ~ x, size=1) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Linear
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), size = matchweight, weight=matchweight)) + geom_point(aes(size=matchweight)) + geom_smooth(method="lm_robust", formula = y ~ x, size=1) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Quadratic
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), size = matchweight, weight=matchweight)) + geom_point(aes(size=matchweight)) + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2), size=1) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Cubic
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), size = matchweight, weight=matchweight)) + geom_point(aes(size=matchweight)) + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2) + I(x^3), size=1) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Linear
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Quadratic
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2)) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
#  Cubic
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + geom_point() + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2) + I(x^3)) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Linear
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + geom_point(alpha = .1) + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Quadratic
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + geom_point(alpha = .1) + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2)) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
#  Cubic
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + geom_point(alpha = .1) + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2) + I(x^3)) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Linear
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + geom_point(alpha = .2) + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Quadratic
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + geom_point(alpha = .2) + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2)) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
#  Cubic
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw))) + geom_point(alpha = .2) + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2) + I(x^3)) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
ihs <- function(x) {
y <- log(x + sqrt(x ^ 2 + 1))
return(y)
}
# Linear
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=ihs(re78), colour = as.factor(nsw))) + geom_point(alpha=.1) + geom_smooth(method="lm_robust", formula = y ~ x) + xlab("Transformed real earnings for 1975") + ylab("Transformed real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Quadratic
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=ihs(re78), colour = as.factor(nsw))) + geom_point(alpha=.1)  + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2)) + xlab("Transformed real earnings for 1975") + ylab("Transformed real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
#  Cubic
lalonde %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=ihs(re78), colour = as.factor(nsw))) + geom_point(alpha=.1)  + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2) + I(x^3)) + xlab("Transformed real earnings for 1975") + ylab("Transformed real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
match_weights = table(c(match_result$index.control, match_result$index.treated))/3
lalonde$matchweight <- 0
lalonde$matchweight[as.numeric(names(match_weights))] <- match_weights # match_weights is the weight for each row number - this is a quick trick to assign the weights to the right rows
# What's the share of observations with 0 weight
mean(lalonde$matchweight == 0)
# Subset the data to post-matching observations
lalonde_postmatch <- lalonde %>% filter(matchweight != 0)
# Scatterplot
lalonde_postmatch %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), size = matchweight)) + geom_point() +  xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Linear
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), size = matchweight, weight=matchweight)) + geom_point(aes(size=matchweight)) + geom_smooth(method="lm_robust", formula = y ~ x, size=1) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Quadratic
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), size = matchweight, weight=matchweight)) + geom_point(aes(size=matchweight)) + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2), size=1) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
# Cubic
lalonde_postmatch  %>% filter(u75 == 0) %>% ggplot(aes(x=log(re75), y=re78, colour = as.factor(nsw), size = matchweight, weight=matchweight)) + geom_point(aes(size=matchweight)) + geom_smooth(method="lm_robust", formula = y ~ x + I(x^2) + I(x^3), size=1) + xlab("Transformed real earnings for 1975") + ylab("Real earnings for 1978") + scale_colour_manual("Treatment", values = c("dodgerblue", "darkorange")) + theme_bw()
setwd("~/Documents/Teaching/plsc*")
setwd("~/Documents/Teaching/plsc30600-causal-inference/slides/week6/assets")
setwd("~/Documents/Teaching/plsc-30600-causal-inference/slides/week6/assets")
lottery <- read_csv("analysis_lottery_household.csv")
library(data.table)
library(tidyverse)
library(patchwork)
library(scales)
library(haven)
library(lm.beta)
library(foreach)
library(fs)
lottery <- read_csv("analysis_lottery_household.csv")
lottery$treat
lottery$slaves_hh_count
mean(lottery$slaves_hh_count[lottery$treat==1])
mean(lottery$slaves_hh_count[lottery$treat==0])
mean(lottery$slaves_hh_count[lottery$treat1==0])
lm_robust(slaves_hh_count ~ treat, data=lottery)
library(estimatr)
lm_robust(slaves_hh_count ~ treat, data=lottery)
lm_robust(slaves_hh_count ~ treat1overN, data=lottery)
lottery$treat1overN
green <- read_dta("green/publicdata.dta")
green$treatment
wapo <- green %>% filter(treatment == "TIMES")
wapo$post
wapo <- green %>% filter(treatment != "TIMES")
mean(wapo$post)
wapo$Bgetsmag
wapo$voted
wapo$voted
wapo$paper
wapo$getpost
sum(!is.na(wapo$getpost))
wapo_survey <- wapo %>% filter(!is.na(getpost))
lm_robust(getpost ~ post, data=wapo_survey)
green <- read_dta("assets/publicdata.dta")
wapo <- green %>% filter(treatment != "TIMES"&!is.na(getwapo))
green <- read_dta("assets/publicdata.dta")
wapost <- green %>% filter(treatment != "TIMES"&!is.na(getpost))
lm_robust(getpost ~ post, data=wapost)
wapost$voted2006g
lm_robust(voted2006g ~ post, data=wapost)
lm_robust(voted2006g ~ times, data=wapost)
wapost$demunfavorable
lm_robust(demunfavorable ~ post, data=wapost)
lm_robust(demunfavorable ~ post, data=green)
lm_robust(demunfavorable ~ post + times, data=green)
lm_robust(voted2006g ~ post + times, data=green)
lm_robust(voted2006g ~ paper, data=green)
wapo$voted
wapost$voted
lm_robust(voted ~ post, data=wapost)
green <- read_dta("assets/publicdata.dta")
wapost <- green %>% filter(treatment != "TIMES"&!is.na(getpost)&!is.na(voted))
lm_robust(getpost ~ post, data=wapost)
lm_robust(voted ~ post, data=wapost)
lm_robust(voted ~ getpost, data=wapost)
coef(lm_robust(voted ~ post, data=wapost))[2]/coef(lm_robust(getpost ~ post, data=wapost))[2]
(mean(wapost$voted[wapost$post == 1]) - mean(wapost$voted[wapost$post == 0]))/(mean(wapost$getpost[wapost$post == 1]) - mean(wapost$getpost[wapost$post == 0]))
iv_robust(voted ~ getpost | post, data=wapost)
